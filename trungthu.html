<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Trung Thu</title>
    <style>
        :root {
            --accent: #ff7f50;
            --accent-2: #ff5722;
        }

        html,
        body {
            height: 100%;
            margin: 0;
            font-family: Inter, "Segoe UI", system-ui, sans-serif;
            background: #060614;
        }

        .stage {
            position: relative;
            min-height: 100vh;
            overflow: hidden;
        }

        canvas#starfield {
            display: block;
            width: 100%;
            height: 100%;
        }

        .moon {
            position: fixed;
            top: 40px;
            right: 60px;
            width: 120px;
            height: 120px;
            background: radial-gradient(circle at 30% 30%, #fff 0%, #f0f0f0 45%, #dcdcdc 100%);
            border-radius: 50%;
            box-shadow:
                0 0 30px rgba(255, 255, 210, 0.8),
                0 0 60px rgba(255, 240, 200, 0.5);
            pointer-events: none;
            z-index: 2;
        }

        #lantern-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 10;
        }

        .lantern {
            position: absolute;
            pointer-events: auto;
            width: 40px;
            user-select: none;
        }

        @keyframes swing {
            0% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
            100% { transform: rotate(-5deg); }
        }

        .swing { animation: swing 2s ease-in-out infinite; }

        #wish-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.96);
            color: var(--accent-2);
            font-family: Inter, "Segoe UI", system-ui, sans-serif;
            padding: 28px 20px;
            border-radius: 12px;
            font-size: 1.05rem;
            font-weight: 700;
            display: none;
            z-index: 9999;
            box-shadow: 0 6px 30px rgba(0, 0, 0, 0.35);
            text-align: center;
            max-width: 90%;
            box-sizing: border-box;
        }

        #hint {
            position: fixed;
            bottom: 8vh;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 14px;
            background: linear-gradient(90deg, rgba(255, 127, 80, 0.95), rgba(255, 87, 34, 0.95));
            color: white;
            border-radius: 999px;
            font-weight: 600;
            z-index: 9998;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.25);
            opacity: 0;
            transition: opacity .35s ease;
            pointer-events: none;
            white-space: pre-line;
        }

        .controls {
            position: fixed;
            left: 18px;
            top: 18px;
            z-index: 10;
            color: #fff;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.2);
            padding: 8px 12px;
            border-radius: 10px;
        }

        .music-toggle {
            cursor: pointer;
            margin-left: 10px;
            color: #fff;
            opacity: 0.95;
        }

        @media (max-width:600px) {
            .moon {
                top: 14px;
                right: 14px;
                width: 70px;
                height: 70px;
                box-shadow: 0 0 12px rgba(255, 240, 200, 0.6);
            }

            #wish-popup { font-size: 0.95rem; padding: 16px 12px; }
            #hint { font-size: 0.9rem; bottom: 12vh; }
        }
    </style>
</head>

<body>
    <div class="stage">
        <canvas id="starfield"></canvas>

        <div class="moon" aria-hidden="true"></div>
        <div id="lantern-container"></div>
        <div id="wish-popup" role="dialog" aria-live="polite"></div>
        <div id="hint">Chạm màn hình để mở nhạc và thả đèn ✨</div>
        <div class="controls">
            <span class="music-toggle" id="musicToggle"></span>
        </div>
    </div>

    <audio id="bg-music" loop>
        <source src="music.mp3" type="audio/mp3">
    </audio>

    <script>
        /* ------------------ Sao và sao băng ------------------ */
        const canvas = document.getElementById('starfield');
        const ctx = canvas.getContext('2d');
        let w, h, stars = [], meteors = [];
        function resizeCanvas() {
            w = canvas.width = innerWidth;
            h = canvas.height = innerHeight;
            stars = [];
            const count = Math.round((w * h) / 2200);
            for (let i = 0; i < count; i++) {
                stars.push({
                    x: Math.random() * w,
                    y: Math.random() * h,
                    r: Math.random() * 0.9 + 0.1,
                    a: Math.random() * 0.8 + 0.2,
                    t: Math.random() * 0.02 + 0.002
                });
            }
        }
        function drawStars() {
            ctx.clearRect(0, 0, w, h);
            for (const s of stars) {
                s.a += (Math.random() > 0.5 ? 1 : -1) * s.t;
                s.a = Math.max(0.05, Math.min(1, s.a));
                ctx.beginPath();
                ctx.globalAlpha = s.a;
                ctx.fillStyle = '#fff';
                ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
                ctx.fill();
            }
            ctx.globalAlpha = 1;
        }
        function createMeteor() {
            const startX = Math.random() * w;
            const startY = Math.random() * (h / 3);
            const speed = Math.random() * 10 + 6;
            meteors.push({ x: startX, y: startY, vx: speed + 6, vy: speed / 2, len: Math.random() * 120 + 100, a: 1 });
        }
        function drawMeteors() {
            for (let i = meteors.length - 1; i >= 0; i--) {
                const m = meteors[i];
                const x2 = m.x - m.len;
                const y2 = m.y - m.len / 2;
                const g = ctx.createLinearGradient(m.x, m.y, x2, y2);
                g.addColorStop(0, `rgba(255,255,255,${m.a})`);
                g.addColorStop(1, 'rgba(255,255,255,0)');
                ctx.strokeStyle = g;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(m.x, m.y);
                ctx.lineTo(x2, y2);
                ctx.stroke();
                m.x += m.vx; m.y += m.vy; m.a -= 0.02;
                if (m.a <= 0 || m.x > w + 200 || m.y > h + 200) meteors.splice(i, 1);
            }
            ctx.strokeStyle = '#fff'; ctx.lineWidth = 1;
        }
        function loop() {
            drawStars();
            drawMeteors();
            if (Math.random() < 0.01) createMeteor();
            requestAnimationFrame(loop);
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        loop();

        /* ------------------ Mây random ------------------ */
        const stage = document.querySelector(".stage");
        const cloudImgs = ["cloud-small.png", "cloud-medium.png"];

        function createCloud() {
            const cloud = document.createElement("img");
            cloud.src = cloudImgs[Math.floor(Math.random() * cloudImgs.length)];
            cloud.style.position = "fixed";
            cloud.style.zIndex = 2; // dưới đèn lồng
            cloud.style.pointerEvents = "none";

            const size = 80 + Math.random() * 120;
            cloud.style.width = size + "px";

            const top = Math.random() * 40; // 0–40% màn hình
            cloud.style.top = top + "vh";

            cloud.style.opacity = 0.3 + Math.random() * 0.4;

            const direction = Math.random() < 0.5 ? "leftToRight" : "rightToLeft";
            const duration = 30000 + Math.random() * 20000;

            if (direction === "leftToRight") {
                cloud.style.left = "-200px";
                stage.appendChild(cloud);
                cloud.animate([
                    { transform: "translateX(0)" },
                    { transform: "translateX(120vw)" }
                ], { duration: duration, easing: "linear", fill: "forwards" });
            } else {
                cloud.style.right = "-200px";
                stage.appendChild(cloud);
                cloud.animate([
                    { transform: "translateX(0)" },
                    { transform: "translateX(-120vw)" }
                ], { duration: duration, easing: "linear", fill: "forwards" });
            }

            setTimeout(() => cloud.remove(), duration);
        }

        setInterval(createCloud, 6000);
        for (let i = 0; i < 3; i++) setTimeout(createCloud, i * 2000);

        /* ------------------ Đèn lồng ------------------ */
        const lanternContainer = document.getElementById('lantern-container');
        const wishes = [
            "Chúc mọi điều tốt đẹp nhất đến với cậu",
            "Mong Hà luôn luôn khỏe mạnh",
            "Cậu sẽ luôn được hạnh phúc",
            "Hà sẽ kiếm được rất nhiều tiền :3",
            "Muốn cậu có thể thấy được biển mây ở Tà Xùa",
            "Cậu sẽ thấy được cực quang tuyệt đẹp ở đỉnh núi Kirkjufell",
            "Một ngày của cậu sẽ có được 48 tiếng :))",
            "Mong cậu sẽ có nhiều thời gian để được ngắm hoàng hôn",
            "Mong cậu ít việc hơn để có thể đi ngủ sớm",
            "Cậu sẽ đánh được đàn guitar và hát",
            "Kiếm được người bạn đời sẽ luôn ở bên cạnh cậu",
            "Muốn cậu có thể đi trượt tuyết và ném bóng tuyết ở Nhật Bản",
            "Muốn cậu có thể được tham gia một buổi âm nhạc thính phòng ở Thụy Điển",
            "Chúc cậu có thể hoàn thành điều ước báo hiếu của mình",
            "Muốn cậu có thể đi lặn ở Nha Trang",
            "Muốn cậu có thể ngắm nhìn dải MilkyWay",
            "Muốn cậu có thể thấy được mùa đom đóm ở vườn Cúc Phương",
            "Cậu sẽ cười nhiều hơn",
            "Muốn cậu có thể đi Hà Giang ăn cơm lam và đi chợ bản",
            "Cậu sẽ luôn tin tưởng vào bản thân",
            "Muốn cậu có thể đi Trekking ở Tà chì nù",
            "Muốn cậu có thể nhảy dù một lần :3",
            "Muốn cậu có thể học được ngôn ngữ kí hiệu",
            "Mong cậu sẽ luôn có những giấc ngủ bình yên",
            "Muốn cậu có thể đi Đà Lạt để chụp đồi thông và ăn bánh tráng nướng",
            "Muốn cậu có thể đến Hà Lan để có thể thấy cối xay gió",
            "Muốn cậu có thể đến ý để tham quan các bảo tàng nghệ thuật",
            "Cậu sẽ kiếm được người có thể để cậu thoải mái làm em bé ",
            "Muốn cậu có thể đến thành cổ Quảng Trị để thắp hương cho các anh hùng liệt sĩ",
            "Muốn cậu có thể đi ngắm lễ hội hoa đăng",
            "Cậu sẽ kiếm được một người cùng cậu nấu ăn",
            "Cậu sẽ kiếm được người ôm và vỗ về cậu",
            "Muốn cậu có thể đi phượt xe vượt đèo",
            "Muốn cậu có thể đến Ai Cập coi kim tự tháp",
            "Muốn cậu có thể làm tình nguyện viên thú cưng",
            "Muốn cậu có thể đi vô định khám phá Hà Nội",
            "Muốn cậu chơi bóng rổ",
            "Cậu sẽ kiếm được người dẫn cậu đi khắp nơi",
            "Muốn cậu có thể đi ngắm được hoa anh đào rơi",
            "Muốn cậu được đi thi dance battle",
            "Cậu sẽ kiếm được người làm bánh mỗi dịp sinh nhật",
            "Cậu sẽ kiếm được người làm đồ len tặng cậu mỗi giáng sinh",
            "Cậu sẽ kiếm được người nhảy cùng cậu",
            "Cậu sẽ kiếm được người có thể lưu được mỗi khoảng khác cùng cậu",
            "Mong cả nhà cậu luôn mạnh khỏe và bình an",
            "Ước rằng mùa trăng nào cậu cũng được về sum họp với gia đình",
            "Mong cha mẹ sẽ bớt vất vả",
            "Mong gia đình sẽ có thêm nhiều kỷ niệm đáng nhớ",
            "Mong bản thân sẽ cân bằng được công việc và cuộc sống",
            "Mong sự nỗ lực hôm nay mang lại thành quả ngày mai",
            "Ước rằng không còn chiến tranh, chỉ còn hòa bình",
            "Ước rằng mỗi người đều được là chính mình",
            "Ước rằng ai cũng được tận hưởng sự ngọt ngào",
            "Mong trái tim ai cũng đầy ắp tình yêu",
            "Ước cho những người khó khăn cũng được sẻ chia",
            "Ước rằng áp lực công việc sẽ bớt nặng nề",
            "Ước cho bản thân cậu luôn kiên trì trước thử thách",
            "Ước cho thi cử của cậu luôn thuận lợi",
            "Ước rằng những cố gắng của cậu sẽ được ghi nhận",
            "Mong có thêm nhiều cơ hội để trải nghiệm",
            "Mong cậu mãi giữ được kỷ niệm tuổi thơ",
            "Ước cho cậu luôn vui vẻ và tràn đầy năng lượng",
            "Ước cho những ước mơ của cậu sẽ thành hiện thực",
            "Ước cho cậu luôn vui vẻ và tràn đầy năng lượng"


        ];

        function createLantern() {
            const lantern = document.createElement("img");
            lantern.src = "https://github.com/Panbap/Trungthu/blob/main/den.png?raw=true";
            lantern.className = "lantern swing";

            const layer = Math.floor(Math.random() * 3) + 1;
            let size = 40, duration = 10000, opacity = 0.8;
            if (layer === 1) { size = 20 + Math.random() * 20; duration = 14000 + Math.random() * 5000; opacity = 0.5; }
            else if (layer === 2) { size = 30 + Math.random() * 30; duration = 12000 + Math.random() * 4000; opacity = 0.7; }
            else { size = 40 + Math.random() * 40; duration = 10000 + Math.random() * 3000; opacity = 0.95; }

            lantern.style.width = size + "px";
            lantern.style.left = Math.random() * 90 + "vw";
            lantern.style.bottom = "0px";
            lantern.style.opacity = opacity;

            lanternContainer.appendChild(lantern);

            const drift = Math.random() * 140 - 70;
            const up = 120 + Math.random() * 40;
            lantern.animate([
                { transform: "translate(0,0)", opacity: opacity },
                { transform: `translate(${drift}px, -${up}vh)`, opacity: 0 }
            ], { duration: duration, easing: "linear", fill: "forwards" });

            setTimeout(() => lantern.remove(), duration);

            lantern.addEventListener("click", (e) => {
                e.stopPropagation();
                const wishPopup = document.getElementById('wish-popup');
                wishPopup.textContent = wishes[Math.floor(Math.random() * wishes.length)];
                wishPopup.style.display = 'block';
            });
        }
        setInterval(createLantern, 500);
        for (let i = 0; i < 4; i++) setTimeout(createLantern, i * 600);

        /* ------------------ Nhạc ------------------ */
        const bg = document.getElementById('bg-music');
        const musicToggle = document.getElementById('musicToggle');
        let musicStarted = false;
        function startMusic() {
            if (musicStarted) return;
            if (!bg) return;
            bg.volume = 0.0;
            bg.play().then(() => {
                let v = 0;
                const i = setInterval(() => {
                    v += 0.05;
                    if (v >= 0.9) { v = 0.9; clearInterval(i); }
                    bg.volume = v;
                }, 120);
                musicStarted = true;
                musicToggle.textContent = '🔊';
                const hint = document.getElementById('hint');
                hint.style.opacity = '1';
                setTimeout(() => hint.style.opacity = '0', 3500);
            }).catch(() => { });
        }
        musicToggle.addEventListener('click', (e) => {
            e.stopPropagation();
            if (!musicStarted) { startMusic(); return; }
            if (bg.paused) { bg.play(); musicToggle.textContent = '🔊'; }
            else { bg.pause(); musicToggle.textContent = '🔈'; }
        });
        document.addEventListener('pointerdown', function onceStart() {
            startMusic();
            document.removeEventListener('pointerdown', onceStart);
        });
        document.addEventListener('click', (e) => {
            const pop = document.getElementById('wish-popup');
            if (pop && pop.style.display === 'block') pop.style.display = 'none';
        });
    </script>
</body>
</html>
